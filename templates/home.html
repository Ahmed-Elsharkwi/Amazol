<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazol</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        header {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: white;
            border-bottom: 1px solid #e0e0e0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;

        }
        #orders{
            position: relative;
            top: 3px;
            height: 36px; 
        }
        .search-bar {
            flex-grow: 1;
            max-width: 500px;
            margin: 0 1rem;
            position: relative;
        }
        .search-bar input {
            width: 100%;
            padding: 0.5rem;
            padding-right: 2.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .search-button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
        }
        .header-buttons {
            display: flex;
            gap: 1rem;
        }
        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            background-color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #login{
            position: relative;
            top: 22px;
            height: 36px;            
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .cart-button {
            position: relative;
            padding-top: 1.5rem;
        }
        .cart-count {
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            position: absolute;
            top: 15px;
            right: 3%;
            transform: translateX(50%);
        }
        main {
            padding: 2rem 0;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 20px;
        }
        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .product-info {
            padding: 1rem;
        }
        .product-title {
            font-size: 1.2rem;
            margin: 0 0 0.5rem 0;
        }
        .product-title:hover{
            color: red;
        }
        .product-price {
            font-size: 1.1rem;
            font-weight: bold;
            margin: 0 0 1rem 0;
        }
        #click_me {
            cursor: pointer;
        }
        .pages {
            width: 200px;
            height: 100px; 
            border: 1px solid black; 
            display: flex; 
            flex-direction: row;
            justify-content: space-around; 
            align-items: center; 
        }
        #container_2{
            width: 100%;
            display: flex;
            justify-content: center;
            position: relative;
            bottom: 40px;
            gap: 20px;
        }
        .page_button {
            width: 50px;
            height: 40px;
            font-size: 20px;
        }
        .bottom-bar {
            position: fixed;
            bottom: 0;
            width: 75%;
            background-color: black;
            padding: 10px 0;
            z-index: 100;
            left: 175px;
            border-radius: 10px;
        }

        .bottom-bar-content {
            display: flex;
            justify-content: flex-end;
            width: 130px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .bottom-bar button {
            background-color: white;
            color: black;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
        }

        .bottom-bar button:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1 class="logo" onclick="get_main_page()">Amazol</h1>
                <button class="btn" id='orders' onclick="get_user_orders()">
                    Orders
                </button>
                <div class="search-bar">
                    <input type="search" placeholder="Search products..." id="searchInput">
                    <button class="search-button" id="searchButton" onclick="renderProducts()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                </div>
                <div class="header-buttons">
                    {% if user %}
                    <button class="btn" id='login' onclick="get_user_info('{{ user }}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        welcome {{ user }}
                    </button>
                    {% else %}

                        <button class="btn" id='login' onclick="sign_in_user()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            Login
                        </button>
                    {% endif %}
                    <div class="cart-button">
                        <span class="cart-count" id="cartCount">0</span>
                        <button class="btn" id="cartBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                            Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main class="container">
        <div class="product-grid" id="productGrid"></div>
    </main>
    <main id="container_2"></main>
    </main>

    <div class="bottom-bar">
        {% if seller %}
            <div class="bottom-bar-content">
                <button onclick="get_seller_info('{{ seller }}')">Work with us</button>
            </div>
        {% else %}
            <div class="bottom-bar-content">
                <button onclick="sign_in_seller()">Work with us</button>
            </div>
        {% endif %}
    </div>
    <script>

        let cartItems = 0;

        function get_user_orders(){
            alert("orders are here")
        }
        function updateCartCount() {
            document.getElementById('cartCount').textContent = cartItems;
        }

        function addToCart(product_info) {

            let product = JSON.parse(localStorage.getItem(product_info.id));
            if (product == null) {
                product_info['quantity'] = 1
                localStorage.setItem(product_info.id, JSON.stringify(product_info))
            }
            else {
                if (product.quantity + 1 > product.amount) {
                    alert("The limit is exceeded")
                    return null
                }
                else {
                    product.quantity = product.quantity + 1
                    localStorage.setItem(product.id, JSON.stringify(product))
                }
            }
            cartItems++;
            updateCartCount();
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.id = product.id;
            card.innerHTML = `
                <img src="/static/banana.jpeg" alt="${product.name}" class="product-image" id="click_me" onclick="get_product_info()">
                <div class="product-info">
                    <h2 class="product-title" id="click_me" onclick="get_product_info()">${product.name}</h2>
                    <p class="product-price" id="click_me" onclick="get_product_info()">${product.price}</p>
                    <button class="btn btn-primary add-to-cart" onclick='addToCart(${JSON.stringify(product)})'>Add to Cart</button>
                </div>
            `;
            return card;
        }

        function get_cart_items(){
            let counter = 0
            for (key in localStorage) {
                product = JSON.parse(localStorage.getItem(key))
                if (product != null) {
                    counter += product.quantity
                } 
            }
            if (counter != cartItems){
                cartItems = counter
                updateCartCount()
            }
        }
        async function renderProducts(page_number) {
            const productGrid = document.getElementById('productGrid');
            const word = document.getElementById('searchInput').value
            
            get_cart_items()
            if (word == '') {
                try {
                    const response = await fetch(`http://localhost:5000/products_data/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({}),
                    });
                    if (response.ok){
                        const data = await response.json();

                        for (const product in data) {
                                productGrid.appendChild(createProductCard(data[product]));

                            }
                    }
        
                } 
                catch (error) {
                    alert(error)
                }
            }
        else {
            pages = document.getElementById('pages_number')
        
            let send_data = {}
            console.log(page_number)
            if (page_number != null && pages != null) {
                send_data['page'] = page_number
                send_data['pages'] = pages.textContent
            }
            try {
                    console.log(word)
                    const response = await fetch(`http://localhost:5000/products_data/${word}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(send_data),
                    });
                    if (response.ok){
                        const data = await response.json();
                        console.log(data); // Access the data here
                        productGrid.innerHTML = ''
                        container_2 = document.getElementById('container_2')
                        container_2.innerHTML = ''
                        
                        for (const product in data) {
                                if (product != 'page' && product != 'pages'){
                                    productGrid.appendChild(createProductCard(data[product]));
                                }
                            }
                            if (data['pages'] != undefined) {
                                let div_buttons = document.createElement('div');
                                div_buttons.className = 'pages'
                                let botton_id = ''

                                for (let page_number = 1; page_number <= data['pages']; page_number++) {
                                    // Create a button for each page number
                                    let div_buttons = document.createElement('div');
                                    div_buttons.className = 'pages_buttons'

                                    if (page_number == data['pages']) {
                                        button_id = 'pages_number'
                                    }
                                    else {
                                        button_id = 'page_number'
                                    }

                                    div_buttons.innerHTML = `
                                        <button class='page_button' id=${button_id} onclick='renderProducts(${page_number})'>${page_number}</button>
                                    `
                                    container_2.appendChild(div_buttons);

                                }

                                // Append the rectangle div to the body or any other container
                            }

                    }
                    else {
                        message = await response.json()
                        console.log(response.json())
                        alert(message)
                    }
        
                } 
                catch (error) {
                    alert(error)
                }
        }
            
        }

        async function get_main_page() {
            window.location.href = "http://localhost:3000/";

        }
        function sign_in_user() {
            window.location.href = "http://localhost:3000/login?type=user&next_page=/";
        }

        function get_user_info(name) {
            console.log(name)
            alert(`welcome mr ${name}`)
            //window.location.href = "http://localhost:3000/user_info";
        }

        function sign_in_seller() {
            window.location.href = "http://localhost:3000/login?type=seller&next_page=/";
        }

        function get_seller_info(name) {
            alert(`welcome seller ${name}`)
        }

        function get_product_info() {
            alert(`product is good`)
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await renderProducts(null);
            updateCartCount();

            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    renderProducts();
                }
            });
        });
    </script>
</body>
</html>
